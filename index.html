<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
	<title>yam3</title>
	<script type="text/javascript" src="js/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var game = new Phaser.Game(640, 480, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render});
    var blocksStartX = 20;
    var blocksStartY = 20;
    var blockPadding = 2;
    var blockSize = 32; 
    var blocksHigh = 5;
    var blocksWide = 10;

    var score = 0;
    var currentTile;
    var blocksGroup; 
    var blocksArray = []; // blocksArray[(y * blocksWide) + x]


    var seed = new Date().getTime();
    var randomBlocks = new Phaser.RandomDataGenerator([seed]);

function preload() {
	//  This sets a limit on the up-scale
    //game.scale.maxWidth = 800; 
    //game.scale.maxHeight = 600;
    
    //Set Scaling Mode
    //game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;

    //Load images
	game.load.spritesheet('blocks', 'img/blocks.png', blockSize, blockSize); 
}

function create() {

    blocksGroup = game.add.group();

    for (y = 0; y < blocksHigh; y++) {
        for (x = 0; x < blocksWide; x++) {
            //var block = game.add.sprite(, 'blocks', 1);
            block = blocksGroup.create((x*(blockSize+blockPadding))+blocksStartX, (y*(blockSize+blockPadding))+blocksStartY, 'blocks', randomBlocks.integerInRange(0,4));
         
            // Enable input.
            block.inputEnabled = true;
            block.input.enableDrag();
            block.events.onDragStart.add(select);
            block.events.onDragStop.add(released);

            game.physics.arcade.enable(block);

            blocksArray.push(block);
        }
    }

    //create the timers
    timer = game.time.create(false);
    timer.start();

    //create events
    //game.input.onUp.add(mouseDragEnd, this); //on mouse release
    //timer.loop(100, dropTiles, this); //ever 200mil seconds drop the blocks 
}

var originalBlockPos = {x: 0, y: 0};
function select(block){

    originalBlockPos.x = block.x;
    originalBlockPos.y = block.y;

    var mouseX = game.input.activePointer.worldX;
    var mouseY = game.input.activePointer.worldY;

    block.x = mouseX;
    block.y = mouseY;  
}
function released(block){
    block.x = originalBlockPos.x;
    block.y = originalBlockPos.y;
}

function update() {
    var mouseX = game.input.activePointer.worldX;
    var mouseY = game.input.activePointer.worldY;

    //currentTile = blockMap.getTileWorldXY(mouseX, mouseY);

    //testAllTiles();
}

function render() {

    game.debug.text('Debug SCORE: ' + score, 16, 16);

}


</script>

</body>
</html>